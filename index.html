<!DOCTYPE html>
<html lang="ko-KR">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>WSBD chat</title>
        <link rel="stylesheet" href="./WSBD.css">
    </head>
    <body class="WSBD-body">
        <header class="WSBD-header">
            <img src="./img/20kg_plate_character-1.jpg" alt="WSBDchat-1">
            <h1>WSBD chat</h1>
        </header>

        <main class="WSBD-main">    
            <div class="WSBD-chat">
                <h2>당신의 운동을 계획해드립니다.</h2>
                <form class="user-physical">
                    <div class="gender">
                        <span>성별을 선택해주세요.</span>
                        <div>
                            <input id="gender1" name="gender" type="radio" value="male" onclick='getGender(event)'>
                            <label for="gender1">남성</label>
                            <input id="gender2" name="gender" type="radio" value="female" onclick='getGender(event)'>
                            <label for="gender2">여성</label>
                        </div>
                    </div>
                    <div class="physical-input">
                        <label for="user-height">키를 입력해주세요.</label>
                        <div>
                            <input class="height" id="user-height" type="number">
                            <span>cm</span>
                        </div>
                    </div>
                    
                    <div class="physical-input">
                        <label for="user-weight">체중을 입력해주세요.</label>
                        <div>
                            <input class="weight" id="user-weight" type="number">
                            <span>kg</span>
                        </div>
                    </div>
    
                    <div class="physical-input">
                        <label for="user-level">3대 운동 총 중량을 입력해주세요.</label>
                        <div>
                            <input class="level" id="user-level" type="number">
                            <span>kg</span>
                        </div>
                        <p>※ 3대 운동이란 스쿼트, 벤치프레스, 데드리프트를 의미합니다.</p>
                    </div>
                    
                    <div class="workout-obj">
                        <label>운동목적이 어떻게 되나요?</label>
                        <select id="workout-obj" onchange="ChangeValue()">
                            <option value="체중감량">체중감량</option>
                            <option value="근력향상">근력향상</option>
                            <option value="린매스업">린매스업</option>
                        </select>
                    </div>

                    <div class="workout-time">
                        <!-- js로 select에 들어갈 옵션들 추가하기 -->
                        <span>하루에 운동할 수 있는 시간이 어느정도인가요?</span>
                        <div>
                            <select id="work-out-time">
                            </select>
                            <label for="work-out-time">시간</label>
                            <select id="work-out-minute">
                            </select>
                            <label for="work-out-minute">분</label>
                        </div>
                    </div>
    
                </form>
                <div class="ai-chat">
                    <button type="submit" class="generate-plan">운동 계획 생성</button>
                    <p>운동계획</p>
                    <div class="textarea"></div>
                </div>
        
                <!-- <img src="./img/20kg_plate_character-2.jpg" alt="WSBDchat-2" style="width:200px"> -->
            </div>
        </main>

    <script>

        let $gender = ''    
        function getGender(event) {
            $gender = event.target.value;
        }
        // 성별이 선택됨에 따라 그 값을 $gender에 할당한다. event.target은 이벤트가 발생한 대상을 뜻한다.

        const $height = document.querySelector('.height')
        const $weight = document.querySelector('.weight')
        const $level = document.querySelector('.level')
        // const $object = document.querySelector('.workout-obj select')
        // const $time = document.querySelector('.workout-time')

        const $button = document.querySelector('button')
        const $answer = document.querySelector('.textarea')
        // 각각 입력값을 dom으로 활용한다는 명시적 표현으로 $변수명으로 변수 할당함. -> 다른 input은 그렇다치고 radio랑 select는 다시 봐야할 듯.

        const data = []
        // data라는 배열을 선언
        data.push({
            'role':'system',
            'content':'assistant는 웨이트 트레이닝, 바디빌딩의 전문가 입니다.'
        })
        // data라는 배열에 역할 부여하는 객체를 추가한다.

        const url = "https://estsoft-openai-api.jejucodingcamp.workers.dev/"
        // chatGPT API를 url 변수에 할당

        $button.addEventListener('click', e=>{
            e.preventDefault() // 클릭했을 때 이벤트 발생 강제로 막기
            // const contents1 = $gender.value
            const contents = `저의 성별은 ${$gender}입니다. 저의 키는 ${$height.value}cm 입니다. 저의 체중은 ${$weight.value}kg 입니다. 저의 벤치프레스, 스쿼트, 데드리프트의 합산 무게는 ${$level.value}kg 입니다. 저의 일주일 운동 루틴을 만들어주세요.`
            // const contents3 = `저의 체중은 ${$weight.value}kg 입니다.`
            // const contents4 = `저의 벤치프레스, 스쿼트, 데드리프트의 합산 무게는 ${$level.value}kg 입니다.`
            // const contents5 = $object.value
            // const contents6 = $time.value
            
            data.push({
                'role':'user',
                'content':contents,
            }) // data 라는 배열에 입력된 값들을 추가한다.

            chatGPTAPI()
        })

        function chatGPTAPI() {
            fetch(url, {
                method: 'POST',
                headers: {'Content-Type' : 'application/json'
            },
            body:JSON.stringify(data),
            redirect: 'follow'
            })
            .then(res => res.json())
            .then(res => {
                console.log(res)
                $answer.innerHTML = `<p>${res.choices[0].message.content}</p>`
            })
        }


    </script>

    </body>
</html>
